<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Ch√° da Suelen</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --admin-bg: #f4f6f8;
            --header-bg: #2c3e50;
            --white: #ffffff;
            --text: #333;
            --green: #27ae60;
            --red: #c0392b;
            --blue: #2980b9;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body { background-color: var(--admin-bg); color: var(--text); }

        /* Login Screen */
        #login-screen {
            height: 100vh; display: flex; justify-content: center; align-items: center;
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
        }
        .login-box {
            background: white; padding: 40px; border-radius: 10px; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 300px;
        }
        .login-box input {
            width: 100%; padding: 10px; margin: 15px 0; border: 1px solid #ddd; border-radius: 5px;
        }

        /* Admin Dashboard */
        header {
            background-color: var(--header-bg); color: white; padding: 15px 30px;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }

        .dashboard-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; }
        
        /* Card de Adicionar */
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card h3 { margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        .form-group input, .form-group select {
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;
        }

        /* Tabela */
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        th { background-color: #ecf0f1; font-weight: 600; color: #555; }
        
        .status-livre { color: var(--green); font-weight: bold; background: #eafaf1; padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; }
        .status-doado { color: var(--blue); font-weight: bold; background: #ebf5fb; padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; }

        /* Bot√µes */
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: 600; transition: 0.3s; }
        .btn-primary { background-color: var(--blue); width: 100%; }
        .btn-danger { background-color: var(--red); font-size: 0.8rem; padding: 5px 10px; }
        .btn-warning { background-color: #f39c12; font-size: 0.8rem; padding: 5px 10px; color: white; }
        .btn:hover { opacity: 0.9; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            table { display: block; overflow-x: auto; }
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2>üîí Acesso Admin</h2>
            <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">Digite a senha do administrador</p>
            <input type="password" id="admin-pass" placeholder="Senha...">
            <button class="btn btn-primary" onclick="login()">Entrar</button>
            <p id="login-msg" style="color: red; margin-top: 10px; font-size: 0.8rem;"></p>
        </div>
    </div>

    <div id="admin-panel" style="display: none;">
        <header>
            <h3>üõ†Ô∏è Admin: Ch√° da Suelen</h3>
            <button onclick="logout()" style="background:none; border:none; color:white; cursor:pointer;">Sair</button>
        </header>

        <div class="container">
            <div class="dashboard-grid">
                
                <div>
                    <div class="card">
                        <h3>‚ûï Adicionar Novo Item</h3>
                        <div class="form-group">
                            <label>Nome do Item</label>
                            <input type="text" id="new-name" placeholder="Ex: Panela de Press√£o">
                        </div>
                        <div class="form-group">
                            <label>Tipo</label>
                            <select id="new-type">
                                <option value="presente">üéÅ Presente</option>
                                <option value="comida">üç© Comida/Bebida</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="addItem()">Adicionar Item</button>
                    </div>
                    
                    <div class="card">
                        <h3>üìä Resumo</h3>
                        <p>Total de Itens: <strong id="total-count">0</strong></p>
                        <p>J√° doados: <strong id="doados-count" style="color: var(--blue)">0</strong></p>
                        <p>Dispon√≠veis: <strong id="livres-count" style="color: var(--green)">0</strong></p>
                    </div>
                </div>

                <div>
                    <div class="card">
                        <h3>üìã Gerenciar Lista Completa</h3>
                        <div id="loading">Carregando dados...</div>
                        <table id="items-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Tipo</th>
                                    <th>Status / Doador</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ïES ---
        const BIN_ID = "691fb9f643b1c97be9ba9680"; 
        const API_KEY = "$2a$10$ZiCe/tRQhbdU4CHOEfyH8O1z6mE6zeCFjFSZB4W2RYHDTIYx4eP/C";
        
        // ‚ö†Ô∏è SENHA DO ADMIN (Defina aqui)
        const SENHA_CORRETA = "admin123"; 
        // ---------------------

        let allData = [];

        // --- SISTEMA DE LOGIN ---
        function login() {
            const pass = document.getElementById('admin-pass').value;
            if (pass === SENHA_CORRETA) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                fetchData(); // Carrega os dados ao logar
            } else {
                document.getElementById('login-msg').innerText = "Senha incorreta!";
            }
        }

        function logout() {
            location.reload();
        }

        // --- FETCH DADOS ---
        async function fetchData() {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': API_KEY }
                });
                const json = await response.json();
                allData = json.record;
                renderTable();
                updateStats();
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                alert("Erro ao carregar dados. Verifique o console.");
                console.error(error);
            }
        }

        // --- SALVAR DADOS NO SERVIDOR ---
        async function saveData(newData, successMsg) {
            try {
                // Efeito visual de carregamento (Opcional, mas bom ter)
                document.body.style.cursor = 'wait';
                
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
                    body: JSON.stringify(newData)
                });

                if (!response.ok) throw new Error("Erro ao salvar");
                
                allData = newData; // Atualiza local
                renderTable();
                updateStats();
                alert(successMsg || "Atualizado com sucesso!");
                
            } catch (error) {
                alert("Erro ao salvar altera√ß√µes.");
            } finally {
                document.body.style.cursor = 'default';
            }
        }

        // --- RENDERIZAR TABELA ---
        function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            // Ordenar: Doados primeiro para f√°cil visualiza√ß√£o
            const sortedData = [...allData].sort((a, b) => (a.doador !== "") ? -1 : 1);

            sortedData.forEach(item => {
                const tr = document.createElement('tr');
                const isTaken = item.doador !== "";

                tr.innerHTML = `
                    <td><strong>${item.nome}</strong></td>
                    <td>${item.tipo === 'presente' ? 'üéÅ' : 'üç©'}</td>
                    <td>
                        ${isTaken 
                            ? `<span class="status-doado">${item.doador}</span>` 
                            : `<span class="status-livre">Livre</span>`
                        }
                    </td>
                    <td>
                        ${isTaken 
                            ? `<button class="btn btn-warning" onclick="resetItem(${item.id})">Liberar</button>` 
                            : ''
                        }
                        <button class="btn btn-danger" onclick="deleteItem(${item.id})">Excluir</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateStats() {
            document.getElementById('total-count').innerText = allData.length;
            document.getElementById('doados-count').innerText = allData.filter(i => i.doador !== "").length;
            document.getElementById('livres-count').innerText = allData.filter(i => i.doador === "").length;
        }

        // --- A√á√ïES ---

        // 1. ADICIONAR ITEM
        function addItem() {
            const name = document.getElementById('new-name').value.trim();
            const type = document.getElementById('new-type').value;

            if (!name) return alert("Digite o nome do item!");

            // Gera um ID novo (Maior ID atual + 1)
            const maxId = allData.reduce((max, item) => item.id > max ? item.id : max, 0);
            
            const newItem = {
                id: maxId + 1,
                nome: name,
                tipo: type,
                doador: ""
            };

            const newData = [...allData, newItem];
            saveData(newData, "Item adicionado!");
            document.getElementById('new-name').value = ''; // Limpa input
        }

        // 2. EXCLUIR ITEM
        function deleteItem(id) {
            if(!confirm("Tem certeza que deseja excluir este item da lista?")) return;

            const newData = allData.filter(item => item.id !== id);
            saveData(newData, "Item exclu√≠do!");
        }

        // 3. RESETAR (LIBERAR) ITEM
        function resetItem(id) {
            if(!confirm("Isso vai apagar o nome do doador e deixar o item dispon√≠vel novamente. Confirma?")) return;

            const newData = allData.map(item => {
                if (item.id === id) return { ...item, doador: "" };
                return item;
            });
            saveData(newData, "Item liberado!");
        }

        // Permitir login com Enter
        document.getElementById('admin-pass').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') login();
        });

    </script>
</body>
</html>
